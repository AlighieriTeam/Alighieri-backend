{% extends "base.html" %}
{% block links %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/home.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/game.css') }}" />
    <script src="{{ url_for('static', filename='scripts/timer.js') }}"></script>
{% endblock %}
{% block title %} Game {% endblock %}
{% block content %}

<div class="container_game">
    <div class="row">
            <canvas id ="screen" class="game_view">
                <!--TODO: Make this universal to choosed game-->
                <!--<script type="text/javascript"  src ="{{ url_for('static', filename='scripts/game-rendering.js') }}" defer></script>-->
            </canvas>
    </div>
    <div class="row">
        <div class="col-sm-6 col-xs-12">
            <div class="grid_div center_div" style="margin-top: 25px;">
                <!--TODO: implement real Player class, this is a simple example-->
                {% for player in players %} <!--generate players-->
                    <div id="player_{{ player.id }}" class="player_div player_gradient_{{ player.id }}">
                        <div class="ls-player-name">{{ player.name }}</div>
                    <div class="ls-player-del"></div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="col-sm-6 col-xs-12">
            <div class="grid_div center_div" style="margin-top: 25px;">
                <div class="timer">
                    <!--TODO: finish session, connection etc, when we create this feature-->
                    <!--TODO: reset timer when we get back by browser arrow-->
                    <span id="time">15:00</span>    <!--after 30s timer finish counting and redirect to the choose page (by JS)-->
                </div>

                <button type="button" class="shadow-none btn btn-lg btn-block btn-success rounded-pill ls-close-button" onclick="window.location.href='/choose'">End game</button>
                <button type="button" class="shadow-none btn btn-lg btn-block btn-success rounded-pill enter-button" onclick="test_me()">test</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    const socketio = io();

    function test_me(){
        socketio.emit('rejoin');    // necessary
        socketio.emit('draw_rectangle', 15, 15, 'blue', 5, 5);
        socketio.emit('draw_circle', 10, 10, 'yellow', 5);
        socketio.emit('draw_text', 20, 20, "Hello");
    }

    var screen = document.getElementById('screen');
    context = screen.getContext('2d');

    socketio.on('drawRectangle', function(data){
        context.fillStyle = data["color"];
        context.fillRect(data["x"], data["y"], data["width"], data["height"]);
    })

    socketio.on('drawCircle', function(data){
        context.moveTo(data["x"], data["y"]);
        context.beginPath();
        context.arc(data["x"], data["y"], data["radius"], 0, 2 * Math.PI, false);
        context.fillStyle = data["color"];
        context.fill();
    })

    socketio.on('drawText', function(data){
        context.fillStyle = "white";
        context.font = "30px Arial";
        context.fillText(data["text"], data["x"], data["y"]);
    })

    socketio.on('clearAll', function(){
        context.fillStyle = "black";
        context.fillRect(0, 0, screen.width, screen.height);
    })

</script>

{% endblock %}